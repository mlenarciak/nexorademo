# next-forge Setup Guide

This guide will help you configure all required services for local development.

## Prerequisites

- Node.js 20+
- PostgreSQL database (or use Neon/Supabase free tier)
- pnpm installed

## Required Services Setup

### 1. Database (PostgreSQL)

Configure in `packages/database/.env`:

```bash
# Option A: Local PostgreSQL
DATABASE_URL=postgresql://user:password@localhost:5432/nexora

# Option B: Neon (recommended for quick start)
# Sign up at https://neon.tech (free tier available)
DATABASE_URL=postgresql://user:password@ep-xxxxx.us-east-2.aws.neon.tech/nexora

# Option C: Supabase
# Sign up at https://supabase.com (free tier available)
DATABASE_URL=postgresql://postgres:[password]@db.[project-ref].supabase.co:5432/postgres
```

After configuring, run migrations:
```bash
pnpm run migrate
```

### 2. Clerk (Authentication) - REQUIRED

**Why:** Handles user authentication, sign-in/sign-up flows

**Setup:**
1. Go to https://dashboard.clerk.com
2. Create account → Create Application
3. Get your keys from **API Keys** section
4. Copy to `.env.local` files

**Environment Variables:**
- `CLERK_SECRET_KEY` - starts with `sk_test_`
- `CLERK_PUBLISHABLE_KEY` - starts with `pk_test_`
- `CLERK_WEBHOOK_SECRET` - Optional for local dev, required for production

**Webhook Setup (Optional for local dev):**
1. In Clerk Dashboard → **Webhooks** → **Add Endpoint**
2. For local dev, use ngrok: `npx ngrok http 3002`
3. Endpoint URL: `https://your-ngrok-url.ngrok.io/webhooks/auth`
4. Select events: `user.*`, `organization.*`, `organizationMembership.*`
5. Copy the signing secret (starts with `whsec_`)

### 3. Resend (Email Service) - REQUIRED

**Why:** Sends transactional emails (contact forms, notifications)

**Setup:**
1. Go to https://resend.com
2. Sign up (free tier: 100 emails/day, 3,000/month)
3. Go to **API Keys** → **Create API Key**
4. Copy the key (starts with `re_`)

**Environment Variables:**
- `RESEND_TOKEN` - Your API key
- `RESEND_FROM` - Email address to send from
  - For testing: use `onboarding@resend.dev`
  - For production: verify your domain

### 4. BaseHub (CMS) - REQUIRED for Web App

**Why:** Manages blog posts and documentation content

**Setup:**
1. Go to https://basehub.com/basehub/next-forge?fork=1
2. Click "Fork this template"
3. In your new BaseHub repo, go to "Connect to Your App"
4. Copy the Read Token (starts with `bshb_pk_`)

**Environment Variables:**
- `BASEHUB_TOKEN` - Your read token

### 5. Stripe (Payments) - REQUIRED for API

**Why:** Handles payment processing and subscriptions

**Setup:**
1. Go to https://dashboard.stripe.com
2. Sign up → Get test API keys
3. Go to **Developers** → **API keys**
4. Copy the **Secret key** (starts with `sk_test_`)

**For webhooks:**
```bash
# Install Stripe CLI
# Then run this to start listening (generates webhook secret automatically)
pnpm run stripe
# Or manually: stripe listen --forward-to localhost:3002/webhooks/payments
```

**Environment Variables:**
- `STRIPE_SECRET_KEY` - Your test secret key
- `STRIPE_WEBHOOK_SECRET` - Generated by Stripe CLI

## Optional Services

### 6. BetterStack (Uptime Monitoring) - Optional

**Setup:**
1. Go to https://betterstack.com
2. Create monitors for your apps
3. Get API key and status page URL

**Environment Variables:**
- `BETTERSTACK_API_KEY`
- `BETTERSTACK_URL` - Your public status page URL

### 7. Sentry (Error Tracking) - Optional

**Setup:**
1. Go to https://sentry.io
2. Create project
3. Copy DSN from project settings

**Environment Variables:**
- `NEXT_PUBLIC_SENTRY_DSN`
- `SENTRY_ORG`
- `SENTRY_PROJECT`

## Quick Start (Minimal Setup)

For the fastest way to get started:

1. **Set up Clerk** (5 minutes)
   - Free tier available
   - Critical for authentication

2. **Set up Resend** (2 minutes)
   - Free tier: 100 emails/day
   - Use `onboarding@resend.dev` for testing

3. **Set up BaseHub** (3 minutes)
   - Fork the template
   - Get your token

4. **Set up Database** (5 minutes)
   - Use Neon free tier
   - Run migrations

5. **Replace placeholders in `.env.local` files**

6. **Start development server:**
```bash
pnpm run dev
```

## Troubleshooting

### "Invalid environment variables" errors

Make sure:
- Clerk keys start with correct prefixes (`sk_test_`, `pk_test_`, `whsec_`)
- Resend token starts with `re_`
- Stripe keys start with `sk_test_`, `whsec_`
- BaseHub token starts with `bshb_pk_`
- All URLs are valid (starting with http:// or https://)

### Webhook secrets not needed for local dev

The code checks if webhook secrets exist before trying to validate webhooks. You can:
- Leave them commented out for local development
- Set up webhooks when deploying to production

### Apps failing to start

Check which app is failing and review its specific requirements:
- `app` - Needs Clerk + Resend + Database
- `api` - Needs Clerk + Resend + Stripe + Database
- `web` - Needs Resend + BaseHub

## Next Steps

After setup:
1. Run `pnpm run dev` to start all apps
2. Visit http://localhost:3000 (main app)
3. Visit http://localhost:3001 (marketing site)
4. Visit http://localhost:3002/health (API health check)

## Service Pricing Summary

All have free tiers suitable for development:

- **Clerk**: Free up to 10,000 MAUs
- **Resend**: Free 100 emails/day, 3,000/month
- **BaseHub**: Free tier available
- **Neon/Supabase**: Free PostgreSQL database
- **Stripe**: Free for testing
- **BetterStack**: Free tier available
- **Sentry**: Free up to 5k errors/month

